# 実装計画

## 1. AWS Lambdaプロジェクト構造とコアインターフェースのセットアップ

- [ ] 1.1 Lambdaプロジェクト構造の作成
  - uvプロジェクトの初期化とpyproject.toml設定
  - 依存関係の追加：mcp_lambda_handler, python-pptx, boto3
  - Lambda用ディレクトリ構造の作成：src/, tests/, deployment/
  - _要件: 1.2, 3.1_

- [ ] 1.2 Lambdaテスト基盤と例外クラスの実装
  - pytest + motoでLambdaテスト環境セットアップ
  - Lambda用例外クラスの実装（PPTXError, ValidationError）
  - Lambdaテストデータファクトリーの作成
  - _要件: 2.5.2_

## 2. データモデルとバリデーションの実装

- [ ] 2.1 Lambda用入力データモデルの実装
  - JSON文字列パーシングのテストケース作成
  - PPTXInputモデルのLambda対応実装
  - ページデータとテキスト配列の検証ロジック
  - _要件: 2.2.2_

- [ ] 2.2 Lambda環境変数設定モデルの実装
  - Lambda環境変数読み込みのテスト作成
  - 制限値設定のLambda対応モデル
  - os.getenv()を使用した環境変数読み込み
  - _要件: 2.6.2, 3.1_

- [ ] 2.3 セキュリティバリデーターの実装
  - 入力制限テストの作成（ページ数、テキスト長等）
  - SecurityValidatorクラスの実装
  - テキストサニタイズ機能の実装
  - _要件: 2.2.2, 3.3_

## 3. PPTX生成エンジンの実装

- [ ] 3.1 基本PPTXジェネレーターのテスト駆動実装
  - 単一スライド生成のテストケース作成
  - PPTXGeneratorクラスの基本実装
  - 白紙レイアウト（slide_layouts[6]）を使用したスライド作成
  - _要件: 2.3.2_

- [ ] 3.2 テキストボックス配置ロジックの実装
  - テキストボックス配置のテストケース作成
  - SimpleVerticalLayoutクラスの実装
  - Position計算とテキストボックス生成機能
  - _要件: 2.3.2_

- [ ] 3.3 複数ページ対応とファイル出力の実装
  - 複数ページ生成のテストケース作成
  - ページループ処理とスライド作成の統合
  - バイナリPPTXデータの生成とBase64エンコード
  - _要件: 2.2.1, 2.4.2_

## 4. AWS Lambda MCPサーバー実装

- [ ] 4.1 mcp_lambda_handlerサーバーのセットアップ
  - MCPLambdaHandlerの基本設定テスト作成
  - lambda_handler関数の実装
  - Function URL経由のMCP通信設定
  - _要件: 2.1.2_

- [ ] 4.2 Lambda用PPTXツール定義と統合
  - @mcp_server.tool()デコレーターのテスト作成
  - create_pptx_from_textツール関数のLambda対応実装
  - JSON文字列パラメータの処理と検証
  - _要件: 2.1.2, 2.2.1_

- [ ] 4.3 Lambda用PPTXサービスクラスの実装
  - Lambda環境対応サービスレイヤーのテスト作成
  - PPTXサービスの同期処理実装
  - バリデーション→生成→バイナリ返却の処理フロー
  - _要件: 2.3.2, 2.4.2_

## 5. エラーハンドリングとロギング

- [ ] 5.1 統一エラーハンドリングシステム
  - エラーハンドリングのテストケース作成
  - ErrorHandlerクラスの実装
  - MCPエラーレスポンスの標準化
  - _要件: 2.5.2_

- [ ] 5.2 Lambda CloudWatchログシステムの実装
  - CloudWatchログ出力のテストケース作成
  - Lambda標準loggingモジュールベースのロガー実装
  - リクエスト/レスポンスログとCloudWatch連携
  - _要件: 3.4, 2.5.2_

- [ ] 5.3 Lambdaメモリ管理とパフォーマンス監視
  - Lambdaメモリ使用量監視のテストケース作成
  - Lambda環境対応リソースマネージャー実装
  - 実行時間とメモリ使用量の監視とCloudWatchメトリクス
  - _要件: 3.1, 3.2_

## 6. テスト実装

- [ ] 6.1 単体テストの完全実装
  - 全モジュールの単体テストカバレッジ80%達成
  - モック使用のPPTX生成テスト
  - エラーケースの網羅的テスト
  - _要件: 4.2_

- [ ] 6.2 Lambda統合テストの実装
  - Lambda Function URL経由のエンドツーエンドテスト
  - 実際のPPTXファイル生成と検証
  - HTTPクライアントでのLambda Function URL接続テスト
  - _要件: 2.1.2, 2.4.2_

- [ ] 6.3 Lambdaパフォーマンステストの実装
  - コールドスタート含むレスポンス時間テスト（5秒以内）
  - Lambda同時実行制限内での負荷テスト
  - Lambdaメモリ設定内でのメモリ使用量テスト
  - _要件: 3.1_

## 7. Lambdaデプロイと最終統合

- [ ] 7.1 Lambdaデプロイメントパッケージの作成
  - Lambda関数メインハンドラーの実装
  - 依存ライブラリを含むデプロイメントパッケージ作成
  - Lambda関数リソース設定と環境変数設定
  - _要件: 2.6.2_

- [ ] 7.2 Lambda Function URL設定とCloudWatch連携
  - Function URLの設定とCORS設定
  - CloudWatch LogsとMetricsの設定
  - 環境変数でのログレベル制御
  - _要件: 2.6.2, 3.4_

- [ ] 7.3 最終検証とAWSデプロイ準備
  - 全要件のLambda環境での受入テスト実行
  - AWS Lambdaベストプラクティス準拠性検証
  - IAMロール、セキュリティグループの設定検証
  - _要件: 全要件の検証_

---

**STATUS**: Lambdaタスク再構成完了  
**NEXT STEP**: `/serena` コマンドでAWS Lambda環境対応の効率的実装を開始